<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Markdown Previewer </title>
    <link rel="stylesheet" href="styles/global.css">
    <link rel="stylesheet" href="styles/styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.2.6/purify.min.js"></script>

</head>

<body>
    <div id="container">
        <div id="md">
            <h1> MARKDOWN </h1>
            <textarea id="md-area" placeholder="insira o código em markdown" onkeyup="output(this.value)"></textarea>
        </div>

        <div id="html">
            <h1> HTML </h1>

            <p id="html-area"></p>

            <div style="display: flex; flex-direction: row;">
                <button id="button-clip" onclick="copyToClipboard('html-area')"> Save to clipboard </button>
                <a href="#" id="button-save" onclick="saveHTML('html-area')"> Save as html </a>
            </div>


            <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
            <script>

                /* função altera o html da div de id=html-area de acordo com o codigo markdown passado por parametro   */
                function output(value) {

                    localStorage.setItem('markdown-text', value) /* salva o codigo markdown no localStorage*/
                    let toHtml = marked(value)
                    document.getElementById('html-area').innerHTML = DOMPurify.sanitize(toHtml, { USE_PROFILES: { html: true } });
                }

                /* função que salva no clipboard o texto do elemento <p> passado por parametro  */
                function copyToClipboard(element) {
                    let e = document.getElementById(element);
                    console.log(e)
                    let elementText = e.textContent; //get the text content from the element
                    navigator.clipboard.writeText(elementText);
                }

                /* faz download do html do elemento com id=elementId */
                function saveHTML(elementId) {
                    let e = document.getElementById(elementId).innerHTML;
                    console.log(e)
                    var link = document.getElementById("button-save");
                    var file = new Blob([e], { type: "html" });
                    var donwloadFile = "index" + "." + "html";
                    link.href = URL.createObjectURL(file);
                    link.download = donwloadFile

                }

                /* quando a page é renderizada */
                window.onload = function () {
                    let markdown_text = localStorage.getItem("markdown-text") /* recupera o codigo markdown do localStorage*/
                    document.getElementById("md-area").innerHTML = markdown_text /* "seta" a text area com o texto recuperado */
                    output(markdown_text) /* passando o markdown para html */
                };


            </script>

        </div>
    </div>

</body>

</html>